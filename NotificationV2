local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local LocalPlayer = Players.LocalPlayer
local guiParent = (gethui and gethui())
    or game:GetService("CoreGui")
    or LocalPlayer:WaitForChild("PlayerGui")

local gui = guiParent:FindFirstChild("DarkNotiGui") or Instance.new("ScreenGui")
gui.Name = "DarkNotiGui"
gui.DisplayOrder = 999999
gui.Parent = guiParent

_G.notificationStack = _G.notificationStack or {}

local function reposition()
    for i,data in ipairs(_G.notificationStack) do
        local target = UDim2.new(1,-280,1,-130-((i-1)*80))
        TweenService:Create(
            data.frame,
            TweenInfo.new(0.35,Enum.EasingStyle.Quint,Enum.EasingDirection.Out),
            {Position = target}
        ):Play()
    end
end

function createNotification(title,message,duration)
    duration = duration or 5

    local f = Instance.new("Frame")
    f.Size = UDim2.fromOffset(270,70)
    f.Position = UDim2.new(1,20,1,-130)
    f.BackgroundColor3 = Color3.fromRGB(20,20,20)
    f.BorderSizePixel = 0
    f.BackgroundTransparency = 1
    f.Parent = gui

    Instance.new("UICorner",f).CornerRadius = UDim.new(0,8)

    local glow = Instance.new("ImageLabel")
    glow.Size = UDim2.new(1,20,1,20)
    glow.Position = UDim2.new(0,-10,0,-10)
    glow.BackgroundTransparency = 1
    glow.Image = "rbxassetid://5108535323"
    glow.ImageColor3 = Color3.new()
    glow.ImageTransparency = 1
    glow.Parent = f

    -- TITLE
    local tl = Instance.new("TextLabel")
    tl.Size = UDim2.new(1,-40,0,20)
    tl.Position = UDim2.fromOffset(10,5)
    tl.BackgroundTransparency = 1
    tl.Font = Enum.Font.GothamBold
    tl.TextSize = 16
    tl.TextXAlignment = Left
    tl.TextColor3 = Color3.new(1,1,1)
    tl.TextTransparency = 1
    tl.Text = title
    tl.Parent = f

    local ml = Instance.new("TextLabel")
    ml.Size = UDim2.new(1,-20,0,40)
    ml.Position = UDim2.fromOffset(10,25)
    ml.BackgroundTransparency = 1
    ml.Font = Enum.Font.Gotham
    ml.TextSize = 14
    ml.TextWrapped = true
    ml.TextXAlignment = Left
    ml.TextYAlignment = Top
    ml.TextColor3 = Color3.fromRGB(200,200,200)
    ml.TextTransparency = 1
    ml.Text = message
    ml.Parent = f

    local close = Instance.new("TextButton")
    close.Size = UDim2.fromOffset(20,20)
    close.Position = UDim2.new(1,-30,0,5)
    close.BackgroundTransparency = 1
    close.Font = Enum.Font.GothamBold
    close.Text = "X"
    close.TextSize = 14
    close.TextColor3 = Color3.new(1,1,1)
    close.TextTransparency = 1
    close.Parent = f

    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(1,0,0,4)
    bar.Position = UDim2.new(0,0,1,-4)
    bar.BackgroundColor3 = Color3.fromRGB(90,90,90)
    bar.BorderSizePixel = 0
    bar.Parent = f
    Instance.new("UICorner",bar).CornerRadius = UDim.new(1,0)

    -- FADE IN
    TweenService:Create(f,TweenInfo.new(.4),{BackgroundTransparency=0}):Play()
    TweenService:Create(glow,TweenInfo.new(.4),{ImageTransparency=.7}):Play()
    TweenService:Create(tl,TweenInfo.new(.4),{TextTransparency=0}):Play()
    TweenService:Create(ml,TweenInfo.new(.4),{TextTransparency=0}):Play()
    TweenService:Create(close,TweenInfo.new(.4),{TextTransparency=0}):Play()

    table.insert(_G.notificationStack,{frame=f})
    reposition()

    local function closeNoti()
        if f:GetAttribute("closing") then return end
        f:SetAttribute("closing",true)

        TweenService:Create(f,TweenInfo.new(.35),{
            Position=UDim2.new(1,20,1,-130),
            BackgroundTransparency=1
        }):Play()

        TweenService:Create(glow,TweenInfo.new(.35),{ImageTransparency=1}):Play()
        TweenService:Create(tl,TweenInfo.new(.35),{TextTransparency=1}):Play()
        TweenService:Create(ml,TweenInfo.new(.35),{TextTransparency=1}):Play()
        TweenService:Create(close,TweenInfo.new(.35),{TextTransparency=1}):Play()

        task.wait(.35)
        f:Destroy()

        for i,v in ipairs(_G.notificationStack) do
            if v.frame==f then
                table.remove(_G.notificationStack,i)
                break
            end
        end

        reposition()
    end

    close.MouseButton1Click:Connect(closeNoti)

    if duration>0 then
        TweenService:Create(bar,TweenInfo.new(duration,Enum.EasingStyle.Linear),{
            Size = UDim2.new(0,0,0,4)
        }):Play()

        task.delay(duration,function()
            if f.Parent then
                closeNoti()
            end
        end)
    end
end
